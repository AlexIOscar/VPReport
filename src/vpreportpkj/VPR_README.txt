

                                                  VPReport
						
____________________________________________________________________________________________________________
0. Описанная версия - v1.3

____________________________________________________________________________________________________________
1. Назначение

Программа предназначена для генерации и текстового вывода сводной информации по сырым выгрузкам,
получаемым с оборудования Vernet Behringer.

____________________________________________________________________________________________________________
2. Главное окно

Отображается при запуске программы. Основные элементы:

Директория-источник - адрес директории, из которой будут взяты все файлы выгрузок, и далее
                      будет составлена пара отчетов (общий и посменный). Помимо файлов, лежащих
                      непосредственно в директории, будет выполнен обход всех подкаталогов на всю
                      глубину, и захвачены также выгрузки оттуда. Производится захват только файлов
                      с расширением .txt, остальные - игнорируются. Если хотя бы в одном файле в
                      указанной директории в какой-либо строке форматирование данных не будет
                      соответствовать формату выгрузки VB, вся попытка построения отчета будет
                      отменена, а пользователь уведомлен об этом сообщением "Wrong line format...".
                      Если в выбранной директории не содержится ни одного файла, либо все файлы .txt
                      пусты, генерация будет прервана с сообщением "Processing set is empty". Элемент
                      представляет собой кнопку, нажатие на которую открывает стандартный интерфейс выбора
                      директории (файлы не отображаются).
					  
Сохранить в директорию - адрес, по которому будут размещены сгенерированные отчеты. Элемент-кнопка, по нажатию
                         открывается окно выбора директории.

Сохранить с именем - основная часть имени, с которым будут сохранены сгенерированные отчеты. Помимо основной
                     части, имя включает также постфиксную часть, показывающую "специализацию" отчета.

____________________________________________________________________________________________________________
3. Состав отчета

Отчет состоит из двух "подотчетов", с постфиксами "_common" и "_shifts" в имени файла. Все файлы отчетов
состоят из обычных текстовых данных, и сохраняются с расширением .txt
common-отчет - общий по всем собранным в процессе обхода директории-источника сырым данным.
shifts-отчет - посменный, содержит данные, разбитые посменно.

____________________________________________________________________________________________________________
4. Содержимое отчетов

Каждый текст отчета содержит набор строк, который может немного меняться в зависимости от типа отчета и
настроек.
Назначение строк:

- Report generated at
дата и время генерации отчета в развернутом формате (день недели, месяц, число, время, часовой пояс, год).

- Source: work period between ... and ...
Период времени, в рамках которого собраны данные для создания отчета. Границы периода привязаны не к
границам смен, или какого-то управляемого пользователем периода, а к конкретным деталям из сырых выгрузок.
Таким образом, по этим двум временным меткам, при желании, всегда можно в сырых данных найти, с какой детали
начался период, и на какой он закончился.

- Mode
Показывает тип механизма, используемого программой для фильтрации входящих данных о времени изготовления деталей.
Может быть трех видов:
brute... - грубое снижение пиков времени (выше допустимого максимума) до некоторого фиксированного,
smart... - "умная" фильтрация входных данных через внутренний репозиторий (хранилище) программы,
none... - отсутствие любой фильтрации, время принимается "как есть".

- Total uptime
Общее время, охваченное отчетом, т.е. прошедшее между началом изготовления первой детали, и до конца
изготовления последней. Отметим, что это НЕ значит, что машина работала, или даже была включена весь этот
период. Эта величина зависит только от сырых данных отчета, которые не несут в себе никаких отметок смен.
Следовательно, это значит также, что, если смена начата, допустим, в 08:00, а первая деталь была начата в 11:00,
то период uptime будет начинаться именно в 11:00.

- Total idle
Общее время, в течение которого внутри периода uptime не выполнялась работа по изготовлению какой-то детали. В
отличие от uptime, это время берется не только из сырых данных, но и модифицируется алгоритмом, в том случае,
если активирован какой-то из режимов фильтрации.

- Operation time
Время, в течение которого внутри периода выполнялась работа по изготовлению деталей. Как и в случае idle-time,
модифицируется фильтрующими алгоритмами (если активны).

- Carriage rollbacks (estimated by time gaps)...[(active)]
Оценочное количество откатов каретки, взятое по признаку выявленных в структуре входящего времени периодов
бездействия, свыше заданного (т.е. если какое-то время, дольше X, ничего не происходит, то это считается
однократным откатом каретки). Метка (active) обозначает, что этот режим выбран для оценки "делового" времени.

- Carriage rollbacks (estimated by total length)...[(active)]
Оценочное количество откатов каретки, взятое по суммарной длине всего обработанного металлопроката, соотнесенной
с назначенной длиной одной единицы сырья (плети), а также с учетом коэффициента использования металла.
Метка (active) обозначает, что этот режим выбран для оценки "делового" времени.

- Carriage rollbacks (estimated by extra cuts)...[(active)]
Оценочное количество откатов каретки, взятое по анализу количества рубов из сырых данных. Если на какой-либо
детали зафиксировано два руба, этот факт считается границей новой единицы сырья, соответственно, для ее захвата
необходим откат каретки, который и учитывается. Оценочно, этот способ наиболее точен. Метка (active) обозначает,
что этот режим выбран для оценки "делового" времени.

- Deal time
Оценочное деловое время. В это время входит операционное время, и время, необходимое для выполнения всех
детектированных откатов каретки. Время одного отката каретки фиксировано, и доступно для настройки.

- Workload, %, by period duration & opTime
Коэффициент загрузки фонда времени, по соотношению длительности охваченного отчетом периода и только операционного
времени (т.е. только того, когда машина фиксировала изготовление деталей, без откатов каретки и прочего).
Отметим особо, что длина периода в этом случае - это uptime (см. выше), а не длина смены.

- Workload, %, by period duration & deal time
Аналогично предыдущему, но в качестве "полезного" выступает деловое время.

- Workload, %, by shift duration & deal time.
Коэффициент загрузки фонда времени, вычисленный по соотношению длительности смены, заданной в настройках, и
деловому времени. Этот пункт появляется только в сменных отчетах (_shifts), и отсутствует в общем (_common).
ВАЖНО: длину смены задает отдельная величина в настройках, никак не связанная с настраиваемой там же "картой"
разбиения суток на смены. Если изменена карта разбиений, то следует привести в соответствие и длительность смены,
иначе оценка загрузки будет неверной. Отсутствует возможность задать разные длины смен для вычисления этой
характеристики, хотя создать смены разной длины в карте разбиений - возможно (дополнительно см. раздел 5).

Группа "Total amounts" содержит сводку некоторых данных, в основном конструктивно-технологического характера:

Total holes - всего выполнено отверстий
Total cuts - всего выполнено рубов
Total mass - суммарная масса деталей
Total length - суммарная длина деталей
Total pieces - всего изготовлено деталей

Общий отчет (_common), помимо описанного выше блока, содержит данные о "подозрительных" фактах в отчете.
Всего в нем два раздела:

- Suspicious time wastes (more than ... seconds) - список подозрительно длинных пустых промежутков, в которые
не выполнялось никаких действий.
Структура записи:
{S} seconds gap detected between {T1} and {T2}
S - количество секунд, в течение которых ничего не фиксировалось
T1 - начало промежутка бездействия
T2 - окончание промежутка бездействия
Порог, промежутки врмени всыше которого сюда попадают, доступен из настроек.

- Suspicious labours (more than ... seconds) - список подозрительно длительно изготавливаемых деталей.
Структура записи:
{S} processing duration detected for {P} at {T}
S - время изготовления
P - полный список атрибутов детали, идентифицирующий ее
T - время готовности детали

____________________________________________________________________________________________________________
5. Настройки и особенности работы

Практически все параметры, с которыми работает программа, могут быть настроены пользователем. Для настройки
необходимо перейти в Меню -> Настройки...
В открывшемся окне можно настроить следующие параметры:

- Время отката каретки, сек
Это время используется для детектирования откатов каретки, если выбран соответствующий механизм, и, во
всех случаях, используется в составе делового времени, как время единичного отката каретки.

- Подозрительный перерыв, больше чем, сек
Если фиксируется промежуток бездействия, дольше указанного, то запись об этом попадёт в список подозрительных
растрат времени (см. раздел 4).

- Подозрительное время обработки, больше чем, сек
Аналогично предыдущему, деталь, время изготовления которой превышает эту величину, будет зафиксирована как
подозрительная. Дополнительно, в случае, если выбран грубый режим фильтрации, то время обработки такой детали
будет уменьшено до заданного фиксированного.

- Адаптировать время выполнения операций
Включает режим фильтрации. Доступно два варианта фильтрации, между которыми можно переключаться
парой радиокнопок (см. далее).

- Уменьшать подозр. время обработки до, сек
Радиокнопка активации режима грубой фильтрации. Просто уменьшает любой подозрительный промежуток до величины,
заданной на поле справа.

- Использовать внутреннее хранилище данных о времени
Включает режим "умной" фильтрации всех входных данных из сырых отчетов (т.е. проверяется каждая деталь из выгрузки,
а не только превышающие порог допустимого времени, как в прошлом пункте). Для понимания работы инструмента необходимо
ознакомиться с разделом 6.1.

- Обновлять хранилище входящими данными
Включает режим "обучения" репозитория (см. 6.1) на вновь поступающих данных. Если отключено, то репозиторий
используется только как источник данных, и не обновляется в процессе работы.

- Фильтр-фактор
Коэффициент, кратно которому время-кандидат (рассматриваемое для данной детали) должно превышать время из
репозитория, чтобы считаться недостоверным. Чем эта величина больше, тем более высокое время можно "продвинуть"
в отчет (и в сам репозиторий, если обучение включено - см. 6.1).

- Длительность смены, минут
Длительность смены, используемая для вычисления коэффициента загрузки фонда времени посменно (см. раздел 4,
пункт "Workload, %, by shift duration & deal time")

- Точки разбиения смены, список через ";"
Поле для внесения временных отметок, по которым отчет будет разбиваться на посменные отчеты (технически, разбивается
весь имеющийся пул деталей, и для каждого создается свой собственный отчет). Время вносится в формате ЧЧ:ММ, временные
точки должны быть разделены знаком ";". Никаких ограничений на количество и относительное расположение временных
точек не накладывается. Следует, однако, иметь в виду, что если сутки разбиваются на неравные по длительности смены,
отсутствует техническая возможность корректно вычислить загруженность фонда времени каждой смены, поскольку ее
длительность задается единым числом (см. выше)

- Длина единицы сырья, мм
Используется для оценки количества откатов каретки в одном из трех существующих оценочных механизмов

- Коэффициент использования металла
Используется для оценки количества откатов каретки в одном из трех существующих оценочных механизмов. Общий для всех
сортаментов проката.

- Методика детектирования откатов каретки
Способ оценки количества откатов каретки, который признается "основным", и его данные используются в расчете делового
времени (остальные два все равно будут выполнены, и их результаты тоже показаны в отчете, но основной способ будет
иметь отметку "(active)").

- Выбрать язык интерфейса (требуется перезапуск)
Выбор языка. Действует только на пользовательский интерфейс окон. Отчет в любом случае генерируется на английском

- Кнопка сохранить
Сохраняет изменения. Если закрыть окно другим способом, то все изменения будут утеряны.

____________________________________________________________________________________________________________
6. Технические аспекты

6.1 Краткое описание работы механизма фильтрации через репозиторий.

По мере работы программы, данные о времени изготовления разных изделий накапливаются во внутреннем
хранилище (репозитории). Любая рассматриваемая деталь, если этот режим активен, проверяется в репозитории на
предмет того, встречалась ли она раньше в выгрузках, и если да, то из хранилища берется усредненное по
некоторому ограниченному количеству последних случаев время изготовления. Если текущее рассматриваемое время
превышает время из репозитория НЕ больше, чем в Х раз, то такое время будет признано достоверным, и пойдет в отчет.
В противном случае проверка считается не пройденной, и вместо времени из сырой выгрузки подставляется время, которое
хранит репозиторий, как вероятно более достоверное. Если проверка была успешно пройдена, то, в зависимости от
настройки, это новое найденное валидное время для данного изделия может быть помещено в репозиторий. Самое старое
время, которое в нем хранилось раньше, удаляется, но только в том случае, если уже превышен максимальный объем
хранимой для данной детали очереди.
Всё это реализует механизм получения скользящего среднего времени по данному изделию с шириной окна усреднения,
равному длине очереди (в версии v1.3 длина очереди не может быть настроена пользователем, и составляет 30 измерений).
Важной особенностью данного механизма является то, что если первым измерением, которое встретит программа в процессе
работы, будет какое-то невалидно высокое, то репозиторий его примет на хранение, поскольку у него нет данных для
сравнения, и это же время пройдет в отчет. Однако, уже при следующей встрече с валидным вариантом времени на ту же
деталь, среднее время радикально уменьшится, и по мере записи достаточного количества валидных величин, его влияние
на принимаемое решение должно свестись на нет, пока в конечном итоге оно не будет вытеснено за пределы очереди. Можно
это рассматривать, как своего рода примитивный процесс обучения репозитория. Его желательно вести на большом объеме
данных, среди которых значительный процент валидных.
Важная дополнительная информация:
Деталь идентифицируется этим механизмом через пару атрибутов "марка" и "позиция". То поле, которое зарезервировано
в существующей схеме работы под "заказ", не используется в идентификации (поскольку изменение заказа не ведет к
изменению конструктива детали). Алгоритм получения имени детали (ключа) "уязвим" к таким ошибкам, как спутанные между
собой атрибуты (ПОЗ.1 + МАРКА.1 и МАРКА.1 + ПОЗ.1 будут приняты как разные детали), неодинаковый подход к сокращению
слов (МАРКА.1 + П.1 - НЕ то же самое, что МАРКА.1 + ПОЗ.1), безразличие к разделяющим символам (ПОЗ.1 и ПОЗ-1
будут распознаны как разные). В то же время, механизм защищен от наличия любых лишних пробельных символов (ПОЗ.1,
ПОЗ. 1 и ПОЗ.  1 - все три варианта эквивалентны), и от различий в регистре букв (Поз.1 и ПОЗ.1 - эквивалентны
(правда, сама CAM-среда ProNC, в которой ведется "программирование" деталей, не допускает строчного варианта
каких-либо букв)). Если перечисленные выше ошибки все же будут допущены, то это не приведет к каким-то фатальным
последствиям - для каждого из вариантов обозначения одной и той же детали всего лишь будет заведена своя очередь в
репозитории, и программа будет "сопровождать" их независимо друг от друга (считая детали разными).